const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){if(4===t.length&&t.every(t=>4===t.length))this.initialState=t,this.restart();else throw Error("Initial state is not valid!")}moveLeft(){if("playing"===this.status){let t=this.moveTiles(!0,!1);this.isStateDifferent(t.state)&&this.updateGame(t)}}moveRight(){if("playing"===this.status){let t=this.moveTiles(!0,!0);this.isStateDifferent(t.state)&&this.updateGame(t)}}moveUp(){if("playing"===this.status){let t=this.moveTiles(!1,!1);this.isStateDifferent(t.state)&&this.updateGame(t)}}moveDown(){if("playing"===this.status){let t=this.moveTiles(!1,!0);this.isStateDifferent(t.state)&&this.updateGame(t)}}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.restart(),this.status="playing",this.putNewNumber(),this.putNewNumber()}restart(){this.state=this.cloneState(this.initialState),this.score=0,this.status="idle",this.firstMoveMade=!1}cloneState(t){let e=[];for(let s=0;s<t.length;s++)e.push([...t[s]]);return e}isStateDifferent(t){for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)if(this.state[e][s]!==t[e][s])return!0;return!1}updateGame(t){this.state=t.state,this.score+=t.score,this.firstMoveMade=!0,this.putNewNumber(),this.isGameLost()?this.status="lose":this.isGameWon()&&(this.status="win")}getFirstMoveMade(){return this.firstMoveMade}getAvailableSpace(){return this.state.reduce((t,e,s)=>(e.forEach((e,i)=>{0===e&&t.push({x:i,y:s})}),t),[])}getRandomSpace(t){return t[Math.floor(Math.random()*t.length)]}getNewNumber(){return 0===Math.floor(10*Math.random())?4:2}putNewNumber(){let t=this.getAvailableSpace(),e=this.getRandomSpace(t);this.state[e.y][e.x]=this.getNewNumber()}isGameLost(){return 0===this.getAvailableSpace().length&&!(this.isStateDifferent(this.moveTiles(!1,!1).state)||this.isStateDifferent(this.moveTiles(!0,!0).state)||this.isStateDifferent(this.moveTiles(!1,!0).state)||this.isStateDifferent(this.moveTiles(!0,!1).state))}isGameWon(){return this.state.some(t=>t.some(t=>2048===t))}getCellCoords(t,e,s){return t?{row:e,column:s}:{row:s,column:e}}moveTiles(t,e,s){let i,r,a,o,l,n;let h=this.cloneState(this.state),u=0,c=h[0].length,m=h.length;t?(i=m,r=c):(i=c,r=m),e?(a=r-2,o=-1,l=r,n=1):(a=1,o=r,l=-1,n=-1);for(let e=0;e<i;e++){let s=Array(r).fill(!1);for(let i=a;i!==o;i-=n){let r=!1,a=i,o=this.getCellCoords(t,e,a),c=this.getCellCoords(t,e,a+n);for(;a+n!==l&&(0===h[c.row][c.column]||h[c.row][c.column]===h[o.row][o.column]&&!s[a+n]&&!r);)h[c.row][c.column]>0&&(r=!0,u+=2*h[c.row][c.column]),h[c.row][c.column]+=h[o.row][o.column],h[o.row][o.column]=0,a+=n,o=this.getCellCoords(t,e,a),c=this.getCellCoords(t,e,a+n);r&&(s[a]=!0)}}return{state:h,score:u}}};function e(){var e;!function(t){let e=document.querySelectorAll(".field-row");for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++){let r=e[s].children[i],a=t[s][i];r.className="field-cell field-cell--"+a,a>0?r.innerText=a:r.innerText=""}}(t.getState()),e=t.getScore(),document.querySelector(".game-score").innerText=e,t.getFirstMoveMade()?(s.className="button restart",s.innerText="Restart"):(s.className="button start",s.innerText="Start"),function(t){switch(document.querySelectorAll(".message").forEach(t=>t.classList.add("hidden")),t){case"idle":document.querySelector(".message-start").classList.remove("hidden");break;case"win":document.querySelector(".message-win").classList.remove("hidden");break;case"lose":document.querySelector(".message-lose").classList.remove("hidden")}}(t.getStatus())}const s=document.querySelector(".button");s.addEventListener("click",()=>{switch(s.innerText){case"Start":t.start();break;case"Restart":t.restart()}e()}),document.addEventListener("keydown",s=>{switch(s.key){case"ArrowUp":s.preventDefault(),t.moveUp();break;case"ArrowRight":s.preventDefault(),t.moveRight();break;case"ArrowDown":s.preventDefault(),t.moveDown();break;case"ArrowLeft":s.preventDefault(),t.moveLeft()}e()});
//# sourceMappingURL=index.c332daef.js.map
